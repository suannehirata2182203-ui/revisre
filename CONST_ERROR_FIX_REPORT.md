# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –ö–†–ò–¢–ò–ß–ï–°–ö–û–ô –û–®–ò–ë–ö–ò

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê
```
[PAYMENT INTERCEPT] Error during injection: TypeError: Assignment to constant variable.
    at IncomingMessage.<anonymous> (/app/server.js:203:22)
```

## üîç –ü–†–ò–ß–ò–ù–ê –û–®–ò–ë–ö–ò

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
```javascript
const bodyString = body.toString(); // –æ–±—ä—è–≤–ª–µ–Ω–æ –∫–∞–∫ const
// ...
bodyString = modifiedBodyString; // ‚ùå –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å const
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –æ—à–∏–±–∫–∞:**
- –í JavaScript –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`const`) –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞—Ç—å –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `TypeError: Assignment to constant variable`
- –û—à–∏–±–∫–∞ –ª–æ–º–∞–µ—Ç –≤—Å—é –æ–±—Ä–∞–±–æ—Ç–∫—É HTML –æ—Ç–≤–µ—Ç–æ–≤
- JavaScript injection –Ω–µ –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è
- –ü–µ—Ä–µ—Ö–≤–∞—Ç checkout –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ó–∞–º–µ–Ω–∞ const –Ω–∞ let

**–ë—ã–ª–æ:**
```javascript
const bodyString = body.toString();
// ...
bodyString = modifiedBodyString; // ‚ùå –û—à–∏–±–∫–∞
```

**–°—Ç–∞–ª–æ:**
```javascript
let bodyString = body.toString(); // ‚úÖ let –≤–º–µ—Å—Ç–æ const
// ...
bodyString = modifiedBodyString; // ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–ë—ã–ª–æ:**
```javascript
res.end(body); // ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Buffer –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∏
```

**–°—Ç–∞–ª–æ:**
```javascript
res.end(bodyString); // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞
// –ò–ª–∏ –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
if (contentType.includes('text/') || contentType.includes('application/json')) {
  res.end(bodyString); // —Å—Ç—Ä–æ–∫–∞
} else {
  res.end(body); // Buffer
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ shopify_pay

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- `/shopify_pay` - —É—Å–∫–æ—Ä–µ–Ω–Ω—ã–π checkout Shopify
- `/shopify_pay/accelerated_checkout` - —É—Å–∫–æ—Ä–µ–Ω–Ω—ã–π checkout
- `/checkouts/internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã checkout
- `/checkouts/` - –æ–±—â–∏–π –ø—É—Ç—å checkout

## üéØ –ü–û–ß–ï–ú–£ –≠–¢–û –î–û–õ–ñ–ù–û –†–ê–ë–û–¢–ê–¢–¨

1. **–ù–µ—Ç –æ—à–∏–±–æ–∫ JavaScript:**
   - `let` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
   - –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - HTML –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º Buffer –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π

3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç:**
   - –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã checkout –ø—É—Ç–µ–π
   - –í–∫–ª—é—á–∞—è shopify_pay –∏ checkouts/internal
   - –ü–æ–ª–Ω—ã–π –æ—Ö–≤–∞—Ç –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –æ–ø–ª–∞—Ç–µ

## üîÑ –ü–û–ß–ï–ú–£ –ü–†–ï–î–´–î–£–©–ò–ô –§–ò–ö–° –ù–ï –†–ê–ë–û–¢–ê–õ

### –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ñ–∏–∫—Å:
```javascript
const bodyString = body.toString();
bodyString = modifiedBodyString; // ‚ùå –û—à–∏–±–∫–∞
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `const` –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å
- JavaScript –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- –í—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTML –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è
- –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ–∫—É—â–∏–π —Ñ–∏–∫—Å:
```javascript
let bodyString = body.toString(); // ‚úÖ let
bodyString = modifiedBodyString; // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –æ—à–∏–±–æ–∫ JavaScript
- –ü–µ—Ä–µ–º–µ–Ω–Ω—É—é –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ HTML —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü–µ—Ä–µ—Ö–≤–∞—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

## üìä –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –î–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–≤–∞—Ç –¥–ª—è:
- `/shopify_pay/accelerated_checkout` - —É—Å–∫–æ—Ä–µ–Ω–Ω—ã–π checkout
- `/checkouts/internal` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `/checkouts/` - –æ–±—â–∏–µ checkout –ø—É—Ç–∏

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã ‚Üí `bodyString` (—Å—Ç—Ä–æ–∫–∞)
- –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí `body` (Buffer)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ content-type –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ:

‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ JavaScript** - `let` –≤–º–µ—Å—Ç–æ `const`
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** - —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞, Buffer –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö
‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç** - –≤–∫–ª—é—á–∞—è shopify_pay –∏ checkouts/internal
‚úÖ **–ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTML —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ñ–∏–∫—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–ª, –ø–æ—Ç–æ–º—É —á—Ç–æ:
‚ùå –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –≤—ã–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É
‚ùå –û—à–∏–±–∫–∞ –ª–æ–º–∞–ª–∞ –≤—Å—é –æ–±—Ä–∞–±–æ—Ç–∫—É HTML
‚ùå JavaScript injection –Ω–µ –≤–Ω–µ–¥—Ä—è–ª—Å—è
‚ùå –ü–µ—Ä–µ—Ö–≤–∞—Ç checkout –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

–¢–µ–ø–µ—Ä—å –æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –∏ –∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

